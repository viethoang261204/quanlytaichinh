<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω T√†i Ch√≠nh</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>üí∞ Qu·∫£n L√Ω T√†i Ch√≠nh</h1>
                <p id="userInfo" style="margin-top: 5px; font-size: 0.9em; opacity: 0.9;"></p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportData()">üì• Xu·∫•t D·ªØ Li·ªáu</button>
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Nh·∫≠p D·ªØ Li·ªáu</button>
                <button class="btn btn-danger" onclick="handleLogout()">üö™ ƒêƒÉng Xu·∫•t</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
            </div>
        </header>

        <!-- Dashboard Summary -->
        <section class="dashboard">
            <div class="summary-card" style="position: relative;">
                <h3>üí∞ Ti·ªÅn Trong V√≠</h3>
                <p class="amount" id="walletAmount" style="color: #f39c12; font-size: 2.2em;">0 ƒë</p>
                <button class="btn btn-primary" onclick="openWalletModal()" style="position: absolute; top: 15px; right: 15px; padding: 8px 16px; font-size: 0.9em;">‚úèÔ∏è C·∫≠p Nh·∫≠t</button>
            </div>
            <div class="summary-card">
                <h3>T·ªïng N·ª£</h3>
                <p class="amount debt" id="totalDebt">0 ƒë</p>
            </div>
            <div class="summary-card">
                <h3>T·ªïng Thu Nh·∫≠p</h3>
                <p class="amount income" id="totalIncome">0 ƒë</p>
            </div>
            <div class="summary-card">
                <h3>% N·ª£ Trung B√¨nh</h3>
                <p class="amount" id="avgDebtPercent">0%</p>
            </div>
            <div class="summary-card">
                <h3>S·ªë D∆∞</h3>
                <p class="amount balance" id="balance">0 ƒë</p>
            </div>
        </section>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('debts')">üìã Qu·∫£n L√Ω N·ª£</button>
            <button class="tab-btn" onclick="showTab('payments')">üí≥ Tr·∫£ N·ª£</button>
            <button class="tab-btn" onclick="showTab('incomes')">üíµ Thu Nh·∫≠p</button>
            <button class="tab-btn" onclick="showTab('expenses')">üí∏ Kho·∫£n Chi</button>
            <button class="tab-btn" onclick="showTab('dashboard')">üìä Dashboard</button>
        </div>

        <!-- Tab: Qu·∫£n L√Ω N·ª£ -->
        <div id="debts-tab" class="tab-content active">
            <div class="section-header">
                <h2>Danh S√°ch N·ª£</h2>
                <button class="btn btn-primary" onclick="openDebtModal()">+ Th√™m N·ª£ M·ªõi</button>
            </div>
            <div class="table-container">
                <table id="debtsTable">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>T√™n Kho·∫£n N·ª£</th>
                            <th>S·ªë Ti·ªÅn N·ª£</th>
                            <th>ƒê√£ Tr·∫£</th>
                            <th>C√≤n L·∫°i</th>
                            <th>% C√≤n L·∫°i</th>
                            <th>Ng√†y T·∫°o</th>
                            <th>Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody id="debtsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab: Tr·∫£ N·ª£ -->
        <div id="payments-tab" class="tab-content">
            <div class="section-header">
                <h2>Tr·∫£ N·ª£</h2>
            </div>
            <div id="paymentsList" class="payments-list">
            </div>
        </div>

        <!-- Tab: Thu Nh·∫≠p -->
        <div id="incomes-tab" class="tab-content">
            <div class="section-header">
                <h2>Qu·∫£n L√Ω Thu Nh·∫≠p</h2>
                <button class="btn btn-primary" onclick="openIncomeModal()">+ Th√™m Thu Nh·∫≠p</button>
            </div>
            <div class="table-container">
                <table id="incomesTable">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Lo·∫°i Thu Nh·∫≠p</th>
                            <th>S·ªë Ti·ªÅn</th>
                            <th>Th√°ng</th>
                            <th>Ghi Ch√∫</th>
                            <th>Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody id="incomesTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab: Kho·∫£n Chi -->
        <div id="expenses-tab" class="tab-content">
            <div class="section-header">
                <h2>Qu·∫£n L√Ω Kho·∫£n Chi</h2>
                <button class="btn btn-primary" onclick="openExpenseModal()">+ Th√™m Kho·∫£n Chi</button>
            </div>
            <div class="table-container">
                <table id="expensesTable">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Danh M·ª•c</th>
                            <th>T√™n Kho·∫£n Chi</th>
                            <th>S·ªë Ti·ªÅn</th>
                            <th>Ng√†y</th>
                            <th>Ghi Ch√∫</th>
                            <th>Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab: Dashboard -->
        <div id="dashboard-tab" class="tab-content">
            <div class="section-header">
                <h2>Dashboard Th·ªëng K√™</h2>
                <div style="display: flex; gap: 10px;">
                    <select id="dashboardPeriod" class="form-group" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;" onchange="updateDashboard()">
                        <option value="week">Tu·∫ßn n√†y</option>
                        <option value="month" selected>Th√°ng n√†y</option>
                        <option value="year">NƒÉm nay</option>
                    </select>
                </div>
            </div>

            <!-- Th·ªëng k√™ t·ªïng quan -->
            <div class="dashboard-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="summary-card">
                    <h3>T·ªïng Chi</h3>
                    <p class="amount debt" id="totalExpenses">0 ƒë</p>
                </div>
                <div class="summary-card">
                    <h3>T·ªïng Thu</h3>
                    <p class="amount income" id="totalIncomes">0 ƒë</p>
                </div>
                <div class="summary-card">
                    <h3>S·ªë D∆∞</h3>
                    <p class="amount balance" id="dashboardBalance">0 ƒë</p>
                </div>
                <div class="summary-card">
                    <h3>S·ªë Giao D·ªãch</h3>
                    <p class="amount" id="totalTransactions">0</p>
                </div>
            </div>

            <!-- Bi·ªÉu ƒë·ªì -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="chart-container" style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">Bi·ªÉu ƒê·ªì Chi Ti√™u Theo Ng√†y</h3>
                    <canvas id="expensesChart"></canvas>
                </div>
                <div class="chart-container" style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">Chi Ti√™u Theo Danh M·ª•c</h3>
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

            <!-- B·∫£ng chi ti·∫øt -->
            <div class="table-container">
                <h3 style="margin-bottom: 15px; color: #333;">Chi Ti·∫øt Giao D·ªãch</h3>
                <table id="dashboardTable">
                    <thead>
                        <tr>
                            <th>Ng√†y</th>
                            <th>Lo·∫°i</th>
                            <th>Danh M·ª•c</th>
                            <th>M√¥ T·∫£</th>
                            <th>S·ªë Ti·ªÅn</th>
                        </tr>
                    </thead>
                    <tbody id="dashboardTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal: Th√™m/S·ª≠a N·ª£ -->
    <div id="debtModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDebtModal()">&times;</span>
            <h2 id="debtModalTitle">Th√™m N·ª£ M·ªõi</h2>
            <form id="debtForm" onsubmit="saveDebt(event)">
                <div class="form-group">
                    <label>T√™n Kho·∫£n N·ª£:</label>
                    <input type="text" id="debtName" required>
                </div>
                <div class="form-group">
                    <label>S·ªë Ti·ªÅn N·ª£ (ƒë):</label>
                    <input type="number" id="debtAmount" min="0" step="1000" required>
                </div>
                <div class="form-group">
                    <label>ƒê√£ Tr·∫£ (ƒë):</label>
                    <input type="number" id="debtPaid" min="0" step="1000" value="0">
                </div>
                <div class="form-group">
                    <label>Ng√†y T·∫°o:</label>
                    <input type="date" id="debtDate" required>
                </div>
                <div class="form-group">
                    <label>Ghi Ch√∫:</label>
                    <textarea id="debtNote" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDebtModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Tr·∫£ N·ª£ -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePaymentModal()">&times;</span>
            <h2>Tr·∫£ N·ª£</h2>
            <form id="paymentForm" onsubmit="savePayment(event)">
                <div class="form-group">
                    <label>Kho·∫£n N·ª£:</label>
                    <select id="paymentDebtId" required>
                        <option value="">-- Ch·ªçn kho·∫£n n·ª£ --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>S·ªë Ti·ªÅn Tr·∫£ (ƒë):</label>
                    <input type="number" id="paymentAmount" min="0" step="1000" required>
                </div>
                <div class="form-group">
                    <label>Ng√†y Tr·∫£:</label>
                    <input type="date" id="paymentDate" required>
                </div>
                <div class="form-group">
                    <label>Ghi Ch√∫:</label>
                    <textarea id="paymentNote" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closePaymentModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">X√°c Nh·∫≠n</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Th√™m/S·ª≠a Thu Nh·∫≠p -->
    <div id="incomeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeIncomeModal()">&times;</span>
            <h2 id="incomeModalTitle">Th√™m Thu Nh·∫≠p</h2>
            <form id="incomeForm" onsubmit="saveIncome(event)">
                <div class="form-group">
                    <label>Lo·∫°i Thu Nh·∫≠p:</label>
                    <select id="incomeType" required>
                        <option value="monthly">Thu Nh·∫≠p H√†ng Th√°ng</option>
                        <option value="other">Kho·∫£n Thu Kh√°c</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>T√™n Thu Nh·∫≠p:</label>
                    <input type="text" id="incomeName" required>
                </div>
                <div class="form-group">
                    <label>S·ªë Ti·ªÅn (ƒë):</label>
                    <input type="number" id="incomeAmount" min="0" step="1000" required>
                </div>
                <div class="form-group">
                    <label>Th√°ng:</label>
                    <input type="month" id="incomeMonth" required>
                </div>
                <div class="form-group">
                    <label>Ghi Ch√∫:</label>
                    <textarea id="incomeNote" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeIncomeModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Th√™m/S·ª≠a Kho·∫£n Chi -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeExpenseModal()">&times;</span>
            <h2 id="expenseModalTitle">Th√™m Kho·∫£n Chi</h2>
            <form id="expenseForm" onsubmit="saveExpense(event)">
                <div class="form-group">
                    <label>Danh M·ª•c:</label>
                    <select id="expenseCategory" required>
                        <option value="an-uong">üçΩÔ∏è ƒÇn U·ªëng</option>
                        <option value="di-lai">üöó ƒêi L·∫°i</option>
                        <option value="mua-sam">üõçÔ∏è Mua S·∫Øm</option>
                        <option value="giai-tri">üéÆ Gi·∫£i Tr√≠</option>
                        <option value="suc-khoe">üíä S·ª©c Kh·ªèe</option>
                        <option value="hoc-tap">üìö H·ªçc T·∫≠p</option>
                        <option value="hoa-don">üí° H√≥a ƒê∆°n</option>
                        <option value="khac">üì¶ Kh√°c</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>T√™n Kho·∫£n Chi:</label>
                    <input type="text" id="expenseName" required>
                </div>
                <div class="form-group">
                    <label>S·ªë Ti·ªÅn (ƒë):</label>
                    <input type="number" id="expenseAmount" min="0" step="1000" required>
                </div>
                <div class="form-group">
                    <label>Ng√†y:</label>
                    <input type="date" id="expenseDate" required>
                </div>
                <div class="form-group">
                    <label>Ghi Ch√∫:</label>
                    <textarea id="expenseNote" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeExpenseModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: C·∫≠p Nh·∫≠t Ti·ªÅn Trong V√≠ -->
    <div id="walletModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeWalletModal()">&times;</span>
            <h2>üí∞ C·∫≠p Nh·∫≠t Ti·ªÅn Trong V√≠</h2>
            <form id="walletForm" onsubmit="updateWallet(event)">
                <div class="form-group">
                    <label>S·ªë Ti·ªÅn Hi·ªán T·∫°i Trong V√≠ (ƒë):</label>
                    <input type="number" id="walletCurrentAmount" min="0" step="1000" readonly style="background: #f0f0f0;">
                </div>
                <div class="form-group">
                    <label>Lo·∫°i Giao D·ªãch:</label>
                    <select id="walletTransactionType" required onchange="toggleWalletTransactionAmount()">
                        <option value="set">ƒê·∫∑t S·ªë Ti·ªÅn (Thay Th·∫ø)</option>
                        <option value="add">Th√™m Ti·ªÅn V√†o V√≠</option>
                        <option value="subtract">R√∫t Ti·ªÅn T·ª´ V√≠</option>
                    </select>
                </div>
                <div class="form-group" id="walletSetAmountGroup">
                    <label>S·ªë Ti·ªÅn M·ªõi (ƒë):</label>
                    <input type="number" id="walletSetAmount" min="0" step="1000" value="0">
                </div>
                <div class="form-group" id="walletTransactionAmountGroup" style="display: none;">
                    <label id="walletTransactionAmountLabel">S·ªë Ti·ªÅn (ƒë):</label>
                    <input type="number" id="walletTransactionAmount" min="0" step="1000" value="0">
                </div>
                <div class="form-group">
                    <label>Ghi Ch√∫:</label>
                    <textarea id="walletNote" rows="3" placeholder="V√≠ d·ª•: L∆∞∆°ng th√°ng 12, R√∫t ti·ªÅn mua s·∫Øm..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeWalletModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">C·∫≠p Nh·∫≠t</button>
                </div>
            </form>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="routing.js"></script>
    <script src="script.js"></script>
    <script>
        // Hi·ªÉn th·ªã th√¥ng tin user
        document.addEventListener('DOMContentLoaded', function() {
            const user = getCurrentUser();
            if (user) {
                document.getElementById('userInfo').textContent = `Xin ch√†o, ${user.name} (${user.username})`;
            }
        });
    </script>
</body>
</html>

